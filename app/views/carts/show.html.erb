<h1 class="text-3xl font-bold text-gray-800 mb-6">Sepetiniz</h1>

<% if @cart_items.empty? %>
  <p class="text-gray-600">Sepetiniz boş.</p>
  <%= link_to "Alışverişe Başla", products_path, class: "text-blue-500 hover:underline mt-4 inline-block" %>
<% else %>
  <div class="flex flex-wrap space-x-6">
    <!-- Sol Sütun - Sepet İçeriği -->
    <div class="w-full lg:w-7/12">
      <div class="bg-white shadow-md rounded-lg p-4 mb-6">
        <% @cart_items.each do |item| %>
          <div class="flex items-center justify-between mb-4 border-b pb-2">
            <div>
              <h3 class="text-lg font-semibold text-gray-800"><%= item.product.name %></h3>
              <p class="text-gray-600">Adet: <%= item.quantity %></p>
              <p class="text-gray-600">Birim Fiyat: <%= number_to_currency(item.product.price, unit: "₺", format: "%n %u", separator: ",") %></p>
              <p class="text-gray-600">Toplam: <%= number_to_currency(item.product.price * item.quantity, unit: "₺", format: "%n %u", separator: ",") %></p>
            </div>
            <div class="flex items-center">
              <%= button_to "-", update_quantity_cart_path(item, quantity: item.quantity - 1), method: :patch, class: "quantity-btn" %>
              <span class="mx-2"><%= item.quantity %></span>
              <%= button_to "+", update_quantity_cart_path(item, quantity: item.quantity + 1), method: :patch, class: "quantity-btn" %>
              <%= button_to "Kaldır", remove_from_cart_path(item), method: :delete, class: "bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 ml-4" %>
            </div>
          </div>
        <% end %>
        
        <div class="mt-4 text-xl font-semibold text-gray-800">
          Kargo: <%= number_to_currency(32.99, unit: "₺", format: "%n %u", separator: ",") %> KDV: <%= number_to_currency(12.99, unit: "₺", format: "%n %u", separator: ",") %>
        </div>
        <p class="text-bold-gray-600 mb-4">Toplam: <%= number_to_currency(@cart_items.sum { |item| item.product.price * item.quantity } + 32.99 + 12.99, unit: "₺", format: "%n %u", separator: ",") %></p> 
        
        <div class="flex space-x-4 mt-6">
          <%= button_to "Tümünü Sil", clear_cart_path, method: :delete, class: "bg-red-500 text-white px-6 py-3 rounded-md hover:bg-red-600" %>
          <%= link_to "Alışverişe Devam Et", products_path, class: "text-blue-500 hover:underline mt-4 inline-block" %>
        </div>
      </div>
    </div>
    
    <!-- Sağ Sütun - Adres Seçimi -->
    <div class="w-full lg:w-4/12 mt-6 lg:mt-0">
      <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Teslimat Adresi</h2>
        
        <% if Current.user && @addresses.present? %>
          <%= form_tag checkout_cart_path, method: :post do %>
            <div class="mb-4">
              <label class="block text-gray-700 mb-2">Adres Seçin</label>
              <select name="address_id" class="w-full border rounded-md p-2">
                <% @addresses.each do |address| %>
                  <option value="<%= address.id %>">
                    <%= address.title %>
                  </option>
                <% end %>
              </select>
            </div>
            
            <div class="mt-6">
              <%= submit_tag "Satın Al", class: "bg-green-500 text-white px-6 py-3 rounded-md hover:bg-green-600 w-full" %>
            </div>
          <% end %>
          
          <div class="mt-4">
            <%= link_to "Yeni Adres Ekle", new_address_path, class: "text-blue-500 hover:underline" %>
          </div>
        <% else %>
          <p class="text-gray-600 mb-4">Kayıtlı adresiniz bulunmamaktadır. Lütfen önce adres ekleyin.</p>
          <%= link_to "Adres Ekle", new_address_path, class: "bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" %>
        <% end %>
      </div>
      
      <% if Current.user %>
        <div class="bg-white shadow-md rounded-lg p-6 mt-4">
          <h2 class="text-xl font-bold text-gray-800 mb-2">Bakiyeniz</h2>
          <p class="text-2xl text-green-600"><%= number_to_currency(Current.user.balance, unit: "₺", format: "%n %u", separator: ",") %></p>
        </div>
      <% end %>
    </div>
  </div>
<% end %>